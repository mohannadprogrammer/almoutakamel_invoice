<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>

        <template id="report_invoice_document_inherit" inherit_id="account.report_invoice_document">
            <xpath expr="//div[hasclass('row')]" position="replace">
                <div class="row" style="align-text: center;">
                    <div class="col-6">
                        <table class="table table-sm o_main_table table-borderless"
                            style="font-size: 14px;">
                            <tr>
                                <td>
                                    <strong> Invoice No </strong>
                                </td>
                                <td>رقم الفاتورة</td>
                                <td>:</td>
                                <td>
                                    <span t-field="o.name" />
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <strong> Invoice Date </strong>
                                </td>
                                <td>تاريخ الفاتورة</td>
                                <td>:</td>

                                <td>
                                    <span t-field="o.invoice_date" />
                                </td>
                            </tr>
                            <tr>

                                <td>
                                    <strong> Payment Type </strong>
                                </td>
                                <td>طريقة الدفع</td>
                                <td>:</td>

                                <td>
                                    <span t-field="o.mo_payment_type" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Referance </strong>
                                </td>
                                <td>المرجع</td>
                                <td>:</td>
                                <td>
                                    <span t-field="o.ref" />
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-6">
                        <h2>
                            <span t-if="not proforma"></span>
                            <span t-else="">PROFORMA</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Sales
                                Invoice فاتورة المبيعات</span>
                            <span t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">Draft
                                Invoice</span>
                            <span t-elif="o.move_type == 'out_invoice' and o.state == 'cancel'">Cancelled
                                Invoice</span>
                            <span t-elif="o.move_type == 'out_refund' and o.state == 'posted'">Credit
                                Note</span>
                            <span t-elif="o.move_type == 'out_refund' and o.state == 'draft'">Draft
                                Credit Note</span>
                            <span t-elif="o.move_type == 'out_refund' and o.state == 'cancel'">Cancelled
                                Credit Note</span>
                            <span t-elif="o.move_type == 'in_refund'">Vendor Credit Note</span>
                            <span t-elif="o.move_type == 'in_invoice'">Vendor Bill</span>
                            <!-- <span t-if="o.name != '/'" t-field="o.name">INV/2023/0001</span> -->
                        </h2>
                        <h4>
                            Tax invoice فاتورة ضريبية
                        </h4>
                    </div>
                </div>
            </xpath>

            <xpath expr="//div[hasclass('mt-5')]" position="replace">
                <table class="table table-sm o_main_table table-borderless" dir="rtl">
                    <tr>

                        <td>العميل</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.name" />
                        </td>
                        <td>الرقم الضريبي</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.vat" />
                        </td>

                    </tr>
                    <tr>
                        <td>رقم العاتف</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.phone" />
                        </td>
                        <td>السجل التجاري</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.vat" />
                        </td>
                    </tr>

                    <tr>
                        <td>العنوان</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.street" />
                        </td>
                        <td>المدينة</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.city" />
                        </td>
                        <td>اسم الحي</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.street2" />
                        </td>

                    </tr>

                    <tr>
                        <td>الرمز البريدي</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.zip" />
                        </td>
                        <td>رقم المبنى</td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.city" />
                        </td>
                        <td>رقم اضافي </td>
                        <td>:</td>
                        <td style="text-align:center;">
                            <span t-field="o.partner_id.mobile" />
                        </td>

                    </tr>
                </table>


                <!-- customer address -->
                <t t-set="current_discount" t-value="0" />
                <t t-set="current_price" t-value="0" />

                <t t-set="current_subtotal" t-value="0" />
                <t t-set="current_total" t-value="0" />
                <table class="table table-sm o_main_table table-bordered"
                    name="invoice_line_table" dir="rtl">
                    <thead>
                        <tr>
                            <th name="th_sequence" class="text-center">
                                <span>Item No </span>
                                <br />
                                <span> رقم الصنف </span>
                            </th>

                            <th name="th_description" class="text-center">
                                <span>Description</span>
                                <br />
                                <span>البيان</span>
                            </th>
                            <th name="th_quantity" class="text-end">
                                <span>Qty</span>
                                <br />
                                <span>الكمية</span>
                            </th>
                            <th name="th_quantity" class="text-center">
                                <span>unit</span>
                                <br />
                                <span>الوحدة</span>
                            </th>
                            <th name="th_priceunit"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Price</span>
                                <br />
                                <span>سعر </span>
                            </th>
                            <th name="th_discount"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Disc.%</span>
                                <br />
                                <span>الخصم %</span>
                            </th>
                            <th name="th_taxes"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Taxable AMT</span>
                                <br />
                                <span>المبلق قبل الضريبة</span>
                            </th>
                            <th name="th_taxes"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Tax</span>
                                <br />
                                <span>الضريبة</span>
                            </th>
                            <th name="th_subtotal" class="text-end">
                                <span>Subtotal</span>
                                <br />
                                <span>المجموع</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="invoice_tbody">
                        <t t-set="lines"
                            t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" />

                        <t t-foreach="lines" t-as="line">
                            <t t-set="current_subtotal"
                                t-value="current_subtotal + line.price_subtotal" />
                            <t t-set="current_total" t-value="current_total + line.price_total" />
                            <t t-set="current_price" t-value="current_price + line.price_unit" />
                            <t t-set="current_discount"
                                t-value="round(current_discount+((line.discount/100)*line.price_total) , 2 )" />


                            <tr
                                t-att-class="'bg-200 fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                                <t t-if="line.display_type == 'product'"
                                    name="account_invoice_line_accountable">
                                    <td name="account_invoice_line_name">
                                        <span t-field="line.id"
                                            t-options="{'widget': 'text'}">Bacon Burger</span>
                                    </td>
                                    <td name="account_invoice_line_name">
                                        <span t-if="line.name" t-field="line.name"
                                            t-options="{'widget': 'text'}">Bacon Burger</span>
                                    </td>
                                    <td name="td_quantity" class="text-end">
                                        <span t-field="line.quantity">3.00</span>

                                    </td>
                                    <td name="td_uom" class="text-end">
                                        <span t-field="line.product_uom_id">
                                            units</span>
                                    </td>
                                    <td name="td_price_unit"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.price_unit">9.00</span>
                                    </td>

                                    <td name="td_discount"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.discount">10.00</span>
                                    </td>

                                    <!-- taxeable total  -->
                                    <td name="td_discount"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.price_subtotal">0</span>
                                    </td>
                                    <t t-set="taxes"
                                        t-value="', '.join([(tax.invoice_label or tax.name) for tax in line.tax_ids])" />
                                    <td name="td_taxes"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }} {{ 'text-nowrap' if len(taxes) &lt; 10 else '' }}">
                                        <span class="text-nowrap"
                                            t-out="round((line.price_total - line.price_subtotal),2)">
                                            27.00</span>
                                    </td>
                                    <td name="td_subtotal" class="text-end o_price_total">
                                        <span class="text-nowrap" t-out="line.price_total">
                                            27.00</span>
                                    </td>
                                </t>

                            </tr>


                        </t>
                    </tbody>
                </table>

                <!-- total rows and QR code  -->
                <div class="row">
                    <div class="col-6">
                        <table class="table table-sm o_main_table table-bordered" dir="rtl">
                            <tr>
                                <td style="background-color:lightgray; padding:10px;">Total </td>
                                <td style="background-color:lightgray;padding:10px;">الاجمالي </td>

                                <td class="text-center" style="padding:10px;">
                                    <span t-out="current_price" />
                                </td>
                            </tr>
                            <tr>
                                <td style="background-color:lightgray;padding:10px;">Discount </td>

                                <td style="background-color:lightgray;padding:10px;">الخصم</td>

                                <td class="text-center" style="padding:10px;">
                                    <span t-out="current_discount" />
                                </td>
                            </tr>
                            <tr>
                                <td style="background-color:lightgray;padding:10px;">Total Befor VAT</td>

                                <td style="background-color:lightgray;padding:10px;">المبلغ غير شامل
                                    الضريبة</td>

                                <td class="text-center" style="padding:10px;">
                                    <span t-out="current_subtotal" />
                                </td>
                            </tr>

                            <tr>
                                <td style="background-color:lightgray;padding:10px;">Total VAT</td>

                                <td style="background-color:lightgray;padding:10px;">اجمالي ضريبة
                                    القيمة المضافة</td>

                                <td class="text-center" style="padding:10px;">
                                    <span t-out="round(current_total - current_subtotal , 2)" />
                                </td>
                            </tr>
                            <tr>
                                <td style="background-color:lightgray;padding:10px;">Total Amount
                                    Due</td>

                                <td style="background-color:lightgray;padding:10px;">اجمالي المبلغ
                                    المستحق</td>

                                <td class="text-center" style="padding:10px;">
                                    <span t-out="current_total" />
                                </td>
                            </tr>

                        </table>
                    </div>

                    <!-- QR Code -->
                    <div class="col-6 text-center">
                        <div class="qrcode me-3" id="qrcode_image">
                            <t t-set="qr_code_url" t-value="o._generate_qr_code(silent_errors=True)" />
                            <p t-if="qr_code_url" class="position-relative mb-0">
                                <img t-att-src="qr_code_url" />
                                <img src="/account/static/src/img/Odoo_logo_O.svg"
                                    id="qrcode_odoo_logo"
                                    class="top-50 start-50 position-absolute bg-white border border-white border-3 rounded-circle"
                                />
                            </p>
                        </div>
                        <!-- <t t-if="o.qr_code">
                            <img t-att-src="'data:image/png;base64,' + o.qr_code" alt="QR Code"
                                style="width: 150px; height: 150px;" />
                        </t>
                        <t t-else="">
                            <img src="/web/static/src/img/placeholder.png" alt="QR Code"
                                style="width: 150px; height: 150px;" />
                        </t> -->
                        <p>Scan the QR code to view invoice details</p>
                    </div>
                </div>
                <!-- bank numbeer row  -->
                <div class="row" style="text-align:center; margin-top: 20px;">
                    <table class="table table-sm o_main_table table-bordered" dir="rtl">
                        <tr>
                            <td style="background-color:lightgray; text-align:center;">مصرف الراجحي</td>
                            <td style="text-align:center;">
                                SA29 8000 0516 6080 1613 6142
                            </td>

                            <td style="background-color:lightgray; text-align:center;">بنك الأهلي</td>
                            <td style="text-align:center;">
                                SA96 1000 0001 4000 1379 0407
                            </td>
                        </tr>
                    </table>
                </div>
                <!-- customer signature and sales man signature and salse man name and phone number -->
                <div class="row" style="text-align:center; margin-top:10px">
                    <table class="table table-sm o_main_table table-borderless" dir="rtl">
                        <tr>
                            <td style="text-align:center; border-bottom: 1px solid black;">
                                <span t-out="o.create_uid.name" />
                            </td>

                            <td style="text-align:center;border-bottom: 1px solid black;">
                                <span t-out="o.create_uid.phone" />

                            </td>

                            <td style=" text-align:center; border-bottom: 1px solid black;">

                            </td>
                            <td style="text-align:center; border-bottom: 1px solid black;">

                            </td>
                        </tr>

                        <tr>
                            <td style=" text-align:center;">
                                Salesman

                            </td>

                            <td style="text-align:center;">
                                salesman Mobile

                            </td>

                            <td style=" text-align:center;">
                                signature

                            </td>
                            <td style="text-align:center;">
                                Customer signature

                            </td>
                        </tr>
                        <tr>
                            <td style=" text-align:center;">
                                البائع

                            </td>

                            <td style="text-align:center;">
                                جوال البائع

                            </td>

                            <td style=" text-align:center;">
                                إمضاء

                            </td>
                            <td style="text-align:center;">
                                إمضاء العميل

                            </td>
                        </tr>
                    </table>
                </div>
            </xpath>

        </template>

    </data>


</odoo>